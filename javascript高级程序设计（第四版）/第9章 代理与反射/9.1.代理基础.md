# 代理基础

- ES6 为的代理和反射为开发者提供**拦截**并向基本操作**嵌入额外行为**的能力
- 代理是目标对象的**抽象**，其可以用作目标对象的**替身**，但**完全独立**于目标对象
- **目标对象**既可**直接被操作**，也可**通过代理来操作**，直接操作会绕过代理施予的行为

<a href="" target="_blank">相关代码 →</a>

## 创建空代理

- 使用`Proxy`构造函数创建代理，接收**目标对象**和**处理程序对象**两个参数（缺一不可）
- 空代理是**最简单**的代理，用空对象作为**处理程序对象**，空代理对象仅作为一个抽象的目标对象

```js
const target = {
  // 目标对象
  id: 'target',
}
const handler = {} // 处理程序对象（空对象）
const proxy = new Proxy(target, handler) // 创建空代理
```

- （默认情况下）空代理对象上执行的**所有操作**都会**应用到目标对象**，反之亦然

```js
console.log(target.id) // 'target'
console.log(proxy.id) // 'target'

target.id = 'foo' // 目标对象属性重新赋值
console.log(target.id) // 'foo'
console.log(proxy.id) // 'foo'，会反映到代理上

proxy.id = 'bar' // 代理属性重新赋值
console.log(target.id) // 'bar'，会反映到目标对象上
console.log(proxy.id) // 'bar'

console.log(target.hasOwnProperty('id')) // true
console.log(proxy.hasOwnProperty('id')) // true
```

- `Proxy`构造函数没有`prototype`属性，也不能使用`instanceof`操作符检测

```js
console.log(Proxy) // [Function: Proxy]
console.log(Proxy.prototype) // undefined
console.log(proxy instanceof Proxy) // TypeError: Function has non-object prototype 'undefined' in instanceof check
```

- 使用严格相等`===`用以**区分代理和目标**

```js
console.log(target === proxy) // false
```

## 定义捕获器

- 使用代理的主要目的是可以**定义捕获器**，即基本操作的拦截器
- 每个捕获器**对应一种基本操作**，可以直接或间接在代理上调用，调用操作时会**先调用捕获器函数，再将操作传播到目标对象**

```js
const target2 = {
  foo: 'bar',
}
const handler2 = {
  // 定义get()捕获器函数，以方法名为键
  get() {
    return 'handler override'
  },
}
const proxy2 = new Proxy(target2, handler2)
```

- `get()`函数可以**通过多种形式触发**并被捕获器拦截到：`proxy[property]`、`proxy.property`和`Object.create(proxy)[property]`
- 只有**代理对象上执行操作**才会**触发捕获器**，目标对象上不会

```js
console.log(proxy2.foo) // 'handler override'，代理对象上操作
console.log(proxy2['foo']) // 'handler override'，代理对象上操作
console.log(Object.create(proxy2).foo) // 'handler override'，代理对象上操作

console.log(target2.foo) // 'bar'，目标对象上操作
console.log(target2['foo']) // 'bar'，目标对象上操作
console.log(Object.create(target2).foo) // 'bar'，目标对象上操作
```

## 总结 & 问点

- 代理的用处是什么？其和目标对象有怎样的关系？
- 如何创建空代理？如何区分空代理对象和目标对象？
- 什么是捕获器？其是如何被调用的？
